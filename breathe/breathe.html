<!DOCTYPE html>
<html>
	<head>
    <style>
        html,
        body {
            width: 1920px;
            height: 1080px;
            margin: 0;
	    background: black;
        }
    </style>
	<script>
			var bdata, sdata, canvas, context, tempCanvas, tctx;
			var breathe, sky;
			var loaded = 0;
			var counter = 0;
			var width = 1920;//window.innerWidth;
			var height = 1080;//window.innerHeight;
			function drawBreathe(){
				loaded++;
				canvas = document.getElementById("c");
				canvas.width = width;
				canvas.height = height;
				context = canvas.getContext("2d");
				breathe = document.getElementById('b');
				context.drawImage(breathe, 0, 0);
				bdata = context.getImageData(0, 0, width, height);
				if(loaded==2){
					startAnim();
				}
			}
			function drawSky(){
				loaded++;
				canvas = document.getElementById("c");
				canvas.width = width;
				canvas.height = height;
				context = canvas.getContext("2d");
				sky = document.getElementById('sk');
				context.drawImage(sky, 0, 0);
				sdata = context.getImageData(0, 0, width, height);
				if(loaded==2){
					startAnim();
				}
			}
			function startAnim(){
				context.drawImage(breathe, 0, 0);
				requestAnimationFrame(draw);
			}
			function draw(){
				var frame = context.getImageData(0, 0, width, height);
				for(var i = 0; i<frame.data.length; i+=4){
					if(bdata.data[i]==0&&bdata.data[i+1]==255&&bdata.data[i+2]==0){
						var pos = i/4;
						var sindex = Math.floor(pos/width)*width+(pos%width-counter)%width;
						if(sindex%width==0)
							sindex+=1;
						sindex*=4;
						frame.data[i] = sdata.data[sindex];
						frame.data[i+1] = sdata.data[sindex+1];
						frame.data[i+2] = sdata.data[sindex+2];
					}
					else{
						frame.data[i] = bdata.data[i];
						frame.data[i+1] = bdata.data[i+1];
						frame.data[i+2] = bdata.data[i+2];
					}
						//frame.data[i] = sdata.data[i];
						//frame.data[i+1] =sdata.data[i+1];
						//frame.data[i+2] = sdata.data[i+2];
				}
				counter++;
				context.putImageData(frame, 0, 0);
				requestAnimationFrame(draw);
			}
			function resizeImg(){
				width = window.innerWidth;
				height = window.innerHeight;
			}
			function playPF(){
				var pf = document.getElementById("pf");
				if(pf.paused){
					pf.play();
				}
				else{
					pf.pause();
					pf.currentTime = 0;
				}
			}
		</script>
	</head>
	<body onresize="resizeImg()">
	<canvas id="c" onclick="playPF()"></canvas>
	<audio id="pf" src="music.mp3"></audio>
	<img src="sky.png" id="sk" onload="drawBreathe()"hidden></img>
	<img src="breathe-gray.png" id="b" onload="drawSky()" hidden></img>
	</body>
	</html>
